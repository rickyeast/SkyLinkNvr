
⏳ Waiting for services to initialize...
⚠️  Application may still be starting up. Check logs with: docker-compose logs -f
root@openmediavault:~/SkyLinkNvr# docker-compose logs -f
WARN[0000] /root/SkyLinkNvr/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion
skylink-nvr-1  | 6:53:35 AM [express] serving on port 8080
skylink-nvr-1  | Failed to initialize scheduled recordings: Error: All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: fetch failed
skylink-nvr-1  |     at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
postgres-1     | The files belonging to this database system will be owned by user "postgres".
postgres-1     | This user must also own the server process.
postgres-1     |
postgres-1     | The database cluster will be initialized with locale "en_US.utf8".
postgres-1     | The default database encoding has accordingly been set to "UTF8".
postgres-1     | The default text search configuration will be set to "english".
postgres-1     |
postgres-1     | Data page checksums are disabled.
redis-1        | 1:C 28 Jul 2025 06:53:34.152 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.
redis-1        | 1:C 28 Jul 2025 06:53:34.154 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
redis-1        | 1:C 28 Jul 2025 06:53:34.154 * Redis version=7.4.5, bits=64, commit=00000000, modified=0, pid=1, just started
redis-1        | 1:C 28 Jul 2025 06:53:34.154 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
redis-1        | 1:M 28 Jul 2025 06:53:34.155 * monotonic clock: POSIX clock_gettime
redis-1        | 1:M 28 Jul 2025 06:53:34.159 * Running mode=standalone, port=6379.
redis-1        | 1:M 28 Jul 2025 06:53:34.160 * Server initialized
postgres-1     |
postgres-1     | fixing permissions on existing directory /var/lib/postgresql/data ... ok
postgres-1     | creating subdirectories ... ok
skylink-nvr-1  |     at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
skylink-nvr-1  |     at async DatabaseStorage.getAllCameras (file:///app/dist/index.js:256:12)
postgres-1     | selecting dynamic shared memory implementation ... posix
postgres-1     | selecting default max_connections ... 100
postgres-1     | selecting default shared_buffers ... 128MB
postgres-1     | selecting default time zone ... UTC
postgres-1     | creating configuration files ... ok
postgres-1     | running bootstrap script ... ok
postgres-1     | sh: locale: not found
skylink-nvr-1  |     at async RecordingService.initializeScheduledRecordings (file:///app/dist/index.js:752:24)
postgres-1     | 2025-07-28 06:53:35.702 UTC [36] WARNING:  no usable system locales were found
postgres-1     | performing post-bootstrap initialization ... ok
postgres-1     | syncing data to disk ... ok
postgres-1     |
postgres-1     |
postgres-1     | Success. You can now start the database server using:
postgres-1     |
postgres-1     |     pg_ctl -D /var/lib/postgresql/data -l logfile start
skylink-nvr-1  | System health error: Error: All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: fetch failed
skylink-nvr-1  |     at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
skylink-nvr-1  |     at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
skylink-nvr-1  |     at async DatabaseStorage.createSystemHealth (file:///app/dist/index.js:333:25)
skylink-nvr-1  |     at async file:///app/dist/index.js:1303:7
skylink-nvr-1  | 6:53:39 AM [express] GET /api/system/health 500 in 43ms :: {"error":"Failed to fetch system health"}
skylink-nvr-1  | System health error: Error: All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: fetch failed
skylink-nvr-1  |     at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
skylink-nvr-1  |     at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
skylink-nvr-1  |     at async DatabaseStorage.createSystemHealth (file:///app/dist/index.js:333:25)
skylink-nvr-1  |     at async file:///app/dist/index.js:1303:7
postgres-1     |
postgres-1     | initdb: warning: enabling "trust" authentication for local connections
postgres-1     | initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.
postgres-1     | waiting for server to start....2025-07-28 06:53:37.018 UTC [42] LOG:  starting PostgreSQL 15.13 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
postgres-1     | 2025-07-28 06:53:37.022 UTC [42] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
postgres-1     | 2025-07-28 06:53:37.040 UTC [45] LOG:  database system was shut down at 2025-07-28 06:53:36 UTC
postgres-1     | 2025-07-28 06:53:37.055 UTC [42] LOG:  database system is ready to accept connections
postgres-1     |  done
postgres-1     | server started
postgres-1     | CREATE DATABASE
postgres-1     |
postgres-1     |
postgres-1     | /usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/init.sql
postgres-1     | ALTER DATABASE
postgres-1     |
postgres-1     |
postgres-1     | waiting for server to shut down....2025-07-28 06:53:37.476 UTC [42] LOG:  received fast shutdown request
postgres-1     | 2025-07-28 06:53:37.482 UTC [42] LOG:  aborting any active transactions
postgres-1     | 2025-07-28 06:53:37.489 UTC [42] LOG:  background worker "logical replication launcher" (PID 48) exited with exit code 1
redis-1        | 1:M 28 Jul 2025 06:53:34.163 * Ready to accept connections tcp
postgres-1     | 2025-07-28 06:53:37.490 UTC [43] LOG:  shutting down
postgres-1     | 2025-07-28 06:53:37.493 UTC [43] LOG:  checkpoint starting: shutdown immediate
postgres-1     | 2025-07-28 06:53:37.623 UTC [43] LOG:  checkpoint complete: wrote 924 buffers (5.6%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.065 s, sync=0.051 s, total=0.134 s; sync files=303, longest=0.007 s, average=0.001 s; distance=4239 kB, estimate=4239 kB
postgres-1     | 2025-07-28 06:53:37.641 UTC [42] LOG:  database system is shut down
postgres-1     |  done
postgres-1     | server stopped
postgres-1     |
postgres-1     | PostgreSQL init process complete; ready for start up.
postgres-1     |
postgres-1     | 2025-07-28 06:53:37.744 UTC [1] LOG:  starting PostgreSQL 15.13 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
postgres-1     | 2025-07-28 06:53:37.745 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
postgres-1     | 2025-07-28 06:53:37.745 UTC [1] LOG:  listening on IPv6 address "::", port 5432
postgres-1     | 2025-07-28 06:53:37.755 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
postgres-1     | 2025-07-28 06:53:37.768 UTC [60] LOG:  database system was shut down at 2025-07-28 06:53:37 UTC
postgres-1     | 2025-07-28 06:53:37.783 UTC [1] LOG:  database system is ready to accept connections
skylink-nvr-1  | 6:53:39 AM [express] GET /api/system/health 500 in 15ms :: {"error":"Failed to fetch system health"}
skylink-nvr-1  | System health error: Error: All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: fetch failed
skylink-nvr-1  |     at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
skylink-nvr-1  |     at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
skylink-nvr-1  |     at async DatabaseStorage.createSystemHealth (file:///app/dist/index.js:333:25)
skylink-nvr-1  |     at async file:///app/dist/index.js:1303:7
skylink-nvr-1  | 6:54:09 AM [express] GET /api/system/health 500 in 20ms :: {"error":"Failed to fetch system health"}
skylink-nvr-1  | System health error: Error: All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: fetch failed
skylink-nvr-1  |     at file:///app/node_modules/@neondatabase/serverless/index.mjs:1345:74
skylink-nvr-1  |     at async NeonPreparedQuery.execute (file:///app/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
skylink-nvr-1  |     at async DatabaseStorage.createSystemHealth (file:///app/dist/index.js:333:25)
skylink-nvr-1  |     at async file:///app/dist/index.js:1303:7
skylink-nvr-1  | 6:54:39 AM [express] GET /api/system/health 500 in 15ms :: {"error":"Failed to fetch system health"}
